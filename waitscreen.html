<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Wait Screen</title>
  <style>
    #fullscreen_area {
      background-color: rgb(239, 239, 239);
      border: 1px solid black;
      margin: 50px auto;
      display: flex;
      flex-direction:column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
  </style>
</head>
<!--
  TODO:
  - [ ] 画像ファイルを読み込み
  - [x] テキストを打ち込み
  - [ ] 音楽ファイルを読み込み
    - [ ] 音楽ファイルを再生、
  - [ ] 時計を表示
    - [ ] テキストで表示、intervalで更新
  - [ ] フルスクリーン表示
-->

<body>
  <h1>waiting screen</h1>
  <div id="controll_box">
    <button id="start_fullscreen_button" onclick="startFullscreen()">Start Fullscreen</button>
    &nbsp;[Esc] to exit fullscreen
    <br />
    Clock: 
    <input type="checkbox" id="show_clock_checkbox" checked>show Clock</input>
    <br />
    Message:
    <input type="text" id="text_message_input" size="40" placeholder="message here">
    <br />
    BGM:
    <input type="file" id="audio_file_input" accept="audio/*" onchange="audioFileSelected()">
    <audio id="audio" controls loop></audio>
    <input type="checkbox" id="audio_loop_checkbox" checked onchange="audioLoopChenged()">loop</input>
  </div>
  <div id="fullscreen_area">
    <!--
    <div id="image_area">
      <img src="https://placehold.jp/400x300.png" alt="image" width="400" height="300">
    </div>
    -->
    <div id="clock_text" style="font-family: 'arial black' ; font-size: 64px;" >
      00:00:00
    </div>
    <div id="text_message" style="font-family: 'sans-serif' ; font-size: 64px;" >
      ここにメッセージを表示
    </div>
  </div>
</body>

<script>
    // ==============================
    let _clockTimer = null;
    function _stopClock() {
      if (_clockTimer) {
        clearInterval(_clockTimer);
        _clockTimer = null;
      }
    }
    
    function _startClock() {
      _clockTimer= setInterval(_updateClock, 1000);
    }

    function _updateClock() {
      const currentTime = new Date();
      const strTime = _2digit(currentTime.getHours()) + ':' + _2digit(currentTime.getMinutes()) + ':' + _2digit(currentTime.getSeconds());
      const clockText = document.getElementById('clock_text');
      clockText.innerText = strTime;
    }

    function _2digit(str) {
      return ('0' + str).slice(-2);
    }
    // ==============================

  function audioLoopChenged() {
    const audio = document.getElementById('audio');
    const loop = document.getElementById('audio_loop_checkbox').checked;
    audio.loop = loop; o
  }

  function audioFileSelected() {
    const audioFile = document.getElementById('audio_file_input').files[0];
    const audio = document.getElementById('audio');
    audio.src = URL.createObjectURL(audioFile);
  }

  function startFullscreen() {
    // -- set text --
    const text = document.getElementById('text_message_input').value;
    const textMessage = document.getElementById('text_message');
    textMessage.innerText = text;

    // -- start fullscreen --
    const fullscreenArea = document.getElementById('fullscreen_area');
    fullscreenArea.requestFullscreen();

    // --- start clock ---
    //keepAnimation = true;
    //requestAnimationFrame(_updateCanvas);
    _startClock();

    // -- play audio --
    const audio = document.getElementById('audio');
    audio.play();

    // -- on exit fullscreen --
    document.addEventListener('fullscreenchange', (event) => {
      if (!document.fullscreenElement) {
        console.log('exited fullscreen');
        const audio = document.getElementById('audio');
        audio.pause();

        _stopClock();
      }
    });
  }




</script>

</html>